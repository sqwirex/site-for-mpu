name: üöÄ Deploy Bot

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: SSH & Deploy
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: ${{ secrets.VPS_PORT }}
        script: |
          cd ~/site-for-mpu/telegram-wordly-bot

          # 1) –∑–∞–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞, –Ω–æ –±–µ–∑ –ø–µ—Ä–µ–∑–∞—Ç–∏—Ä–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö JSON
          git fetch origin main
          git reset --hard origin/main

          # 2) –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—Ç–æ–º –≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç)
          docker rm -f wordly-bot || true
          docker build -t wordly-bot .
          docker run -d \
            --name wordly-bot \
            --restart unless-stopped \
            --env-file .env \
            -v "$(pwd)":/app \
            wordly-bot

    - name: Sync JSON ‚Üí Repo
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: ${{ secrets.VPS_PORT }}
        script: |
          cd ~/site-for-mpu/telegram-wordly-bot
          # —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—ã–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ JSON-—Ñ–∞–π–ª—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ Git
          git add vocabulary.json feedback.json user_activity.json
          git commit -m "Sync dictionaries and activity (auto)" || echo "No changes"
          git push origin main
